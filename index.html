<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Annotation Demo (Mobile Interface)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4f46e5;
            --primary-light: #818cf8;
            --success-color: #10b981;
            --bg-light: #f1f5f9; /* Lighter background for app shell effect */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* Container focused for mobile simulation */
        #app-container {
            width: 100%;
            max-width: 500px; /* Max width to simulate mobile/tablet device */
            background-color: white;
            /* Enhanced shadow for 'app' look */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1); 
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Styles for the bounding box overlay (Dynamic generation) */
        #annotation-area {
            position: relative;
            cursor: crosshair;
            touch-action: none; /* Prevents unwanted scrolling on touch */
        }
        
        .bounding-box {
            position: absolute;
            border: 3px solid var(--primary-color);
            box-sizing: border-box;
            pointer-events: none;
            border-radius: 4px;
            transition: all 0.1s ease;
        }

        .box-label {
            position: absolute;
            top: -24px;
            left: -3px;
            background-color: var(--primary-color);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px 4px 0 0;
            font-weight: 600;
        }
        
        .temp-box {
            border-style: dashed !important;
            background-color: rgba(79, 70, 229, 0.1); 
        }

        .final-box {
            border-style: solid !important;
            background-color: rgba(79, 70, 229, 0.3); 
        }
        
        .loading-bar-container {
            width: 90%; /* Wider bar */
            height: 10px;
            background-color: #e5e7eb;
            border-radius: 9999px;
            margin: 20px auto;
            overflow: hidden;
        }

        .loading-bar {
            height: 100%;
            width: 0;
            background-color: var(--success-color);
            border-radius: 9999px;
            transition: width 0.3s ease-in-out;
            animation: load-animation 2s forwards;
        }
        
        @keyframes load-animation {
            from { width: 0; }
            to { width: 100%; }
        }
        
        /* Custom styles for mobile-friendly buttons */
        .primary-btn {
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 700; /* Bolder font */
            transition: background-color 0.15s ease-in-out, transform 0.1s;
        }
        .primary-btn:hover {
            background-color: #4338ca;
        }
        .primary-btn:active {
            transform: scale(0.98);
        }
        
        /* Task Card Hover/Active effect */
        .task-card:active .task-card-inner {
            transform: scale(0.98);
            opacity: 0.8;
        }

        /* SVG Icon styling */
        .icon {
            width: 24px;
            height: 24px;
            cursor: pointer;
            transition: color 0.15s;
        }
    </style>
</head>
<body class="antialiased">

    <div id="app-container">
        <!-- Header (App Bar) -->
        <header class="bg-white p-4 sticky top-0 z-10 shadow-md">
            <div class="flex justify-between items-center">
                <!-- Menu Icon -->
                <svg class="icon text-gray-600 hover:text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
                <h1 id="header-title" class="text-xl font-extrabold text-gray-900 transition duration-300">Task List</h1>
                <!-- Profile Icon -->
                <svg class="icon text-gray-600 hover:text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-grow p-4 overflow-y-auto">
            
            <!-- 1. Task List (appState: 'list') -->
            <div id="list-view" class="space-y-6">

                <!-- User Stats / Dashboard Card -->
                <div class="bg-indigo-600 text-white p-4 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center mb-3 border-b border-indigo-500/50 pb-2">
                        <h2 class="text-lg font-bold">My Annotation Stats</h2>
                        <!-- Dynamic Date using JS -->
                        <p id="current-date" class="text-xs font-medium opacity-80"></p> 
                    </div>

                    <div class="grid grid-cols-3 gap-3 text-sm">
                        <!-- Available Tasks (Total: 13) -->
                        <div class="p-2 bg-indigo-700 rounded-lg text-center shadow-md">
                            <p class="opacity-75 text-xs font-semibold">Available Tasks</p>
                            <p class="text-2xl font-extrabold mt-1">13</p> 
                        </div>

                        <!-- Completed (This Week) -->
                        <div class="p-2 bg-indigo-700 rounded-lg text-center shadow-md">
                            <p class="opacity-75 text-xs font-semibold">Completed (Week)</p>
                            <p class="text-2xl font-extrabold mt-1">94</p>
                        </div>

                        <!-- Total Income (Blurred) -->
                        <div class="p-2 bg-indigo-700 rounded-lg text-center shadow-md">
                            <div class="flex items-center justify-center space-x-1 opacity-75">
                                <p class="text-xs font-semibold">Total Income</p>
                                <svg class="w-3 h-3 text-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M1.60603 6.08062C2.11366 5.86307 2.70154 6.09822 2.9191 6.60585L1.99995 6.99977C2.9191 6.60585 2.91924 6.60618 2.9191 6.60585L2.91858 6.60465C2.9183 6.604 2.91851 6.60447 2.91858 6.60465L2.9225 6.61351C2.92651 6.62253 2.93339 6.63785 2.94319 6.65905C2.96278 6.70147 2.99397 6.76735 3.03696 6.85334C3.12302 7.02546 3.25594 7.27722 3.43737 7.58203C3.80137 8.19355 4.35439 9.00801 5.10775 9.81932C5.28532 10.0105 5.47324 10.2009 5.67173 10.3878C5.68003 10.3954 5.68823 10.4031 5.69633 10.4109C7.18102 11.8012 9.25227 12.9998 12 12.9998C13.2089 12.9998 14.2783 12.769 15.2209 12.398C16.4469 11.9154 17.4745 11.1889 18.3156 10.3995C19.2652 9.50815 19.9627 8.54981 20.4232 7.81076C20.6526 7.44268 20.8207 7.13295 20.9299 6.91886C20.9844 6.81192 21.0241 6.72919 21.0491 6.67538C21.0617 6.64848 21.0706 6.62884 21.0758 6.61704L21.0808 6.60585C21.2985 6.0985 21.8864 5.86312 22.3939 6.08062C22.9015 6.29818 23.1367 6.88606 22.9191 7.39369L22 6.99977C22.9191 7.39369 22.9192 7.39346 22.9191 7.39369L22.9169 7.39871L22.9134 7.40693L22.9019 7.43278C22.8924 7.4541 22.879 7.48354 22.8618 7.52048C22.8274 7.59434 22.7774 7.69831 22.7115 7.8275C22.5799 8.08566 22.384 8.44584 22.1206 8.86844C21.718 9.5146 21.152 10.316 20.4096 11.1241L21.2071 11.9215C21.5976 12.312 21.5976 12.9452 21.2071 13.3357C20.8165 13.7262 20.1834 13.7262 19.7928 13.3357L18.9527 12.4955C18.3884 12.9513 17.757 13.3811 17.0558 13.752L17.8381 14.9544C18.1393 15.4173 18.0083 16.0367 17.5453 16.338C17.0824 16.6392 16.463 16.5081 16.1618 16.0452L15.1763 14.5306C14.4973 14.7388 13.772 14.8863 13 14.9554V16.4998C13 17.0521 12.5522 17.4998 12 17.4998C11.4477 17.4998 11 17.0521 11 16.4998V14.9556C10.2253 14.8864 9.50014 14.7386 8.82334 14.531L7.83814 16.0452C7.53693 16.5081 6.91748 16.6392 6.45457 16.338C5.99165 16.0367 5.86056 16.5081 6.16177 14.9544L6.94417 13.7519C6.24405 13.3814 5.61245 12.9515 5.04746 12.4953L4.20706 13.3357C3.81654 13.7262 3.18337 13.7262 2.79285 13.3357C2.40232 12.9452 2.40232 12.312 2.79285 11.9215L3.59029 11.1241C2.74529 10.2043 2.12772 9.292 1.71879 8.605C1.5096 8.25356 1.35345 7.95845 1.2481 7.74776C1.19539 7.64234 1.15529 7.55783 1.12752 7.49771C1.11363 7.46765 1.10282 7.44366 1.09505 7.42618L1.08566 7.4049L1.08267 7.39801L1.0816 7.39553L1.08117 7.39453C1.08098 7.39409 1.08081 7.39369 1.99995 6.99977L1.08117 7.39453C0.863613 6.8869 1.0984 6.29818 1.60603 6.08062Z" fill="currentColor"></path> </g></svg>
                            </div>
                            <!-- Blurring the income number -->
                            <p class="text-2xl font-extrabold blur-sm mt-1">156<span class="text-lg">$</span></p> 
                        </div>
                    </div>
                </div>

                <!-- Updated Header Title -->
                <p class="text-sm text-gray-600 font-medium">Today's Tasks </p>
                
                <div id="image-list-grid" class="grid grid-cols-2 gap-4">
                    
                    <!-- Task 1 (COMPLETED) - Piranha -->
                    <div class="task-card pointer-events-none">
                        <div class="task-card-inner bg-gray-100 rounded-xl shadow-lg overflow-hidden opacity-70 transition duration-150">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://th-thumbnailer.cdn-si-edu.com/0go7YN5KSuFN6PatmRDunWDOQzc=/400x300/filters:no_upscale()/https://tf-cmsv2-smithsonianmag-media.s3.amazonaws.com/filer/201105200900451505117524_e34ec14652-400x300.jpg" onerror="this.src='https://placehold.co/400x300/e0f2f1/0f766e?text=Artifact'" alt="Object 1" class="w-full h-full object-cover transition duration-300 blur-sm">
                                <div class="absolute inset-0 flex items-center justify-center text-white font-extrabold text-xl bg-black bg-opacity-50">PROCESSED</div>
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 873451</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-green-500 text-white task-badge">COMPLETED</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Task 2 (COMPLETED) - Sunset -->
                    <div class="task-card pointer-events-none">
                        <div class="task-card-inner bg-gray-100 rounded-xl shadow-lg overflow-hidden opacity-70 transition duration-150">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://live.staticflickr.com/8296/7814305688_abe35c6801_o.jpg" onerror="this.src='https://placehold.co/600x450/ffe4e6/be185d?text=Cityscape'" alt="Object 2" class="w-full h-full object-cover transition duration-300 blur-sm">
                                <div class="absolute inset-0 flex items-center justify-center text-white font-extrabold text-xl bg-black bg-opacity-50">PROCESSED</div>
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 921008</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-green-500 text-white task-badge">COMPLETED</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Task 3 (COMPLETED) - Maclura -->
                    <div class="task-card pointer-events-none">
                        <div class="task-card-inner bg-gray-100 rounded-xl shadow-lg overflow-hidden opacity-70 transition duration-150">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://yaskravaklumba.com.ua/image/cachewebp/catalog/dekorativka/makljura/makljurapomarancheva5-500x500.webp" onerror="this.src='https://placehold.co/500x500/dbeafe/1e40af?text=Fruit'" alt="Object 3" class="w-full h-full object-cover transition duration-300 blur-sm">
                                <div class="absolute inset-0 flex items-center justify-center text-white font-extrabold text-xl bg-black bg-opacity-50">PROCESSED</div>
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 654321</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-green-500 text-white task-badge">COMPLETED</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- New Task 4 (Active) - Film 1 -->
                     <div class="task-card" data-id="410567" onclick="selectImage(this)" data-src="https://ipolaroid.com.ua/sites/default/files/fuji_gw690ii_portra_400.jpg">
                        <div class="task-card-inner bg-white rounded-xl shadow-lg overflow-hidden transition duration-150 cursor-pointer">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://ipolaroid.com.ua/sites/default/files/fuji_gw690ii_portra_400.jpg" onerror="this.src='https://placehold.co/400x300/0f172a/94a3b8?text=Image+4'" alt="Object 4" class="w-full h-full object-cover transition duration-300">
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 410567</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-yellow-400 text-gray-800 task-badge">NEW</span>
                            </div>
                        </div>
                    </div>

                    <!-- New Task 5 (Active) - Film 2 -->
                    <div class="task-card" data-id="567234" onclick="selectImage(this)" data-src="https://ipolaroid.com.ua/sites/default/files/kodak_portra_400_36_-_4.jpg">
                        <div class="task-card-inner bg-white rounded-xl shadow-lg overflow-hidden transition duration-150 cursor-pointer">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://ipolaroid.com.ua/sites/default/files/kodak_portra_400_36_-_4.jpg" onerror="this.src='https://placehold.co/400x300/a3e635/3f6212?text=Image+5'" alt="Object 5" class="w-full h-full object-cover transition duration-300">
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 567234</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-yellow-400 text-gray-800 task-badge">NEW</span>
                            </div>
                        </div>
                    </div>

                    <!-- New Task 6 (Active) - Film 3 -->
                    <div class="task-card" data-id="689301" onclick="selectImage(this)" data-src="https://ipolaroid.com.ua/sites/default/files/kentmere_400_pentax_k1000_50mm.jpg">
                        <div class="task-card-inner bg-white rounded-xl shadow-lg overflow-hidden transition duration-150 cursor-pointer">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://ipolaroid.com.ua/sites/default/files/kentmere_400_pentax_k1000_50mm.jpg" onerror="this.src='https://placehold.co/400x300/818cf8/3730a3?text=Image+6'" alt="Object 6" class="w-full h-full object-cover transition duration-300">
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 689301</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-yellow-400 text-gray-800 task-badge">NEW</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- New Task 7 (Active) - Film 4 -->
                    <div class="task-card" data-id="735914" onclick="selectImage(this)" data-src="https://ipolaroid.com.ua/sites/default/files/pentax_67ii_105mm_f2.4_w_kodak_portra_400.jpg">
                        <div class="task-card-inner bg-white rounded-xl shadow-lg overflow-hidden transition duration-150 cursor-pointer">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://ipolaroid.com.ua/sites/default/files/pentax_67ii_105mm_f2.4_w_kodak_portra_400.jpg" onerror="this.src='https://placehold.co/400x300/34d399/064e3b?text=Image+7'" alt="Object 7" class="w-full h-full object-cover transition duration-300">
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 735914</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-yellow-400 text-gray-800 task-badge">NEW</span>
                            </div>
                        </div>
                    </div>

                    <!-- NEW Task 8 -->
                    <div class="task-card" data-id="102938" onclick="selectImage(this)" data-src="https://ipolaroid.com.ua/sites/default/files/pentax_mx_portra_400.jpg">
                        <div class="task-card-inner bg-white rounded-xl shadow-lg overflow-hidden transition duration-150 cursor-pointer">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://ipolaroid.com.ua/sites/default/files/pentax_mx_portra_400.jpg" onerror="this.src='https://placehold.co/400x300/fbbf24/92400e?text=Image+8'" alt="Object 8" class="w-full h-full object-cover transition duration-300">
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 102938</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-yellow-400 text-gray-800 task-badge">NEW</span>
                            </div>
                        </div>
                    </div>

                    <!-- NEW Task 9 -->
                    <div class="task-card" data-id="203456" onclick="selectImage(this)" data-src="https://komirnyk.com.ua/image/cache/webp/catalog/blog/kvasolya-yak-sadyty/kvasolija-400x300.webp">
                        <div class="task-card-inner bg-white rounded-xl shadow-lg overflow-hidden transition duration-150 cursor-pointer">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://komirnyk.com.ua/image/cache/webp/catalog/blog/kvasolya-yak-sadyty/kvasolija-400x300.webp" onerror="this.src='https://placehold.co/400x300/99f6e4/0f766e?text=Image+9'" alt="Object 9" class="w-full h-full object-cover transition duration-300">
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 203456</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-yellow-400 text-gray-800 task-badge">NEW</span>
                            </div>
                        </div>
                    </div>

                    <!-- NEW Task 11 -->
                    <div class="task-card" data-id="405678" onclick="selectImage(this)" data-src="https://ogden_images.s3.amazonaws.com/www.theintelligencer.net/images/2025/10/15094715/USE-DSCN0420-1100x825-1.jpeg">
                        <div class="task-card-inner bg-white rounded-xl shadow-lg overflow-hidden transition duration-150 cursor-pointer">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://ogden_images.s3.amazonaws.com/www.theintelligencer.net/images/2025/10/15094715/USE-DSCN0420-1100x825-1.jpeg" onerror="this.src='https://placehold.co/400x300/fecaca/9f1239?text=Image+11'" alt="Object 11" class="w-full h-full object-cover transition duration-300">
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 405678</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-yellow-400 text-gray-800 task-badge">NEW</span>
                            </div>
                        </div>
                    </div>

                    <!-- NEW Task 12 -->
                    <div class="task-card" data-id="506789" onclick="selectImage(this)" data-src="https://funtime.com.ua/u/i/gallery/2023/07/emily-resort-6-64c79da8992d5.jpg">
                        <div class="task-card-inner bg-white rounded-xl shadow-lg overflow-hidden transition duration-150 cursor-pointer">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://funtime.com.ua/u/i/gallery/2023/07/emily-resort-6-64c79da8992d5.jpg" onerror="this.src='https://placehold.co/400x300/bae6fd/0369a1?text=Image+12'" alt="Object 12" class="w-full h-full object-cover transition duration-300">
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 506789</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-yellow-400 text-gray-800 task-badge">NEW</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- NEW Task 13 -->
                    <div class="task-card" data-id="607890" onclick="selectImage(this)" data-src="https://funtime.com.ua/u/i/gallery/2023/07/emily-resort-2-64c79da89aaba.jpg">
                        <div class="task-card-inner bg-white rounded-xl shadow-lg overflow-hidden transition duration-150 cursor-pointer">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://funtime.com.ua/u/i/gallery/2023/07/emily-resort-2-64c79da89aaba.jpg" onerror="this.src='https://placehold.co/400x300/a3e635/3f6212?text=Image+13'" alt="Object 13" class="w-full h-full object-cover transition duration-300">
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 607890</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-yellow-400 text-gray-800 task-badge">NEW</span>
                            </div>
                        </div>
                    </div>

                    <!-- NEW Task 14 -->
                    <div class="task-card" data-id="708901" onclick="selectImage(this)" data-src="https://funtime.com.ua/u/i/gallery/2023/07/emily-resort-13-64c79da8c9956.jpg">
                        <div class="task-card-inner bg-white rounded-xl shadow-lg overflow-hidden transition duration-150 cursor-pointer">
                            <div class="relative w-full h-32 overflow-hidden">
                                <img src="https://funtime.com.ua/u/i/gallery/2023/07/emily-resort-13-64c79da8c9956.jpg" onerror="this.src='https://placehold.co/400x300/34d399/064e3b?text=Image+14'" alt="Object 14" class="w-full h-full object-cover transition duration-300">
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-bold text-gray-800 truncate">ID: 708901</p>
                                <span class="inline-block mt-1 px-3 py-1 text-xs font-bold rounded-full bg-yellow-400 text-gray-800 task-badge">NEW</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. Annotation Area (appState: 'annotate') -->
            <div id="annotate-view" class="hidden space-y-4">
                <p class="text-sm font-semibold text-indigo-600 mb-2">Task ID: <span class="font-bold" id="current-task-id-display"></span></p>

                <div id="annotation-area" class="relative w-full border-4 border-gray-300 rounded-xl overflow-hidden select-none shadow-2xl">
                    <img id="current-image" src="" alt="Image for Annotation" class="w-full h-auto object-contain block" ondragstart="return false;">
                    <!-- Dynamic Bounding Boxes will be children here -->
                </div>

                <div class="p-4 bg-white rounded-xl shadow-lg space-y-4 mt-4">
                    <h3 class="text-lg font-bold text-gray-800 border-b pb-2">Drawn Boxes (<span id="box-count">0</span>)</h3>
                    
                    <!-- List of annotations to be labeled/saved -->
                    <div id="annotations-list" class="space-y-3">
                        <p id="no-boxes-message" class="text-sm text-gray-500 italic">Draw a box on the image above to begin annotation.</p>
                        <!-- Annotation items will be appended here -->
                    </div>
                    
                    <!-- Final Submission Button -->
                    <button id="submit-annotation-btn" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-xl transition duration-150 primary-btn mt-6" onclick="submitAnnotation()">
                        <div class="flex items-center justify-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                            <span>Submit All <span id="submit-count">0</span> Annotations</span>
                        </div>
                    </button>
                    
                    <button id="clear-all-btn" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 rounded-xl transition duration-150 primary-btn mt-3" onclick="clearAllAnnotations()">
                        <div class="flex items-center justify-center space-x-2">
                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                             <span>Clear All Boxes</span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- 3. Submission/Confirmation Screen (appState: 'submitting'/'confirmed') -->
            <div id="submission-view" class="hidden text-center p-8">
                <div id="loading-state">
                    <svg class="animate-spin h-12 w-12 text-indigo-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="mt-4 text-xl font-bold text-gray-800">Uploading annotation...</p>
                    <div class="loading-bar-container">
                        <div id="loading-bar" class="loading-bar" style="width: 0%;"></div>
                    </div>
                    <p class="text-sm text-gray-500">Processing Task ID: <span id="processing-id" class="font-bold"></span></p>
                </div>
                
                <div id="confirmation-state" class="hidden">
                    <svg class="h-20 w-20 text-success-color mx-auto animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h2 class="mt-4 text-3xl font-extrabold text-gray-900">Task Completed!</h2>
                    <p class="mt-2 text-md text-gray-600">Your task #<span id="confirmed-task-id" class="font-bold text-indigo-600"></span> has been successfully submitted.</p>
                    
                    <div class="mt-6 p-4 bg-indigo-50 rounded-xl shadow-inner text-left border border-indigo-200">
                        <h3 class="font-extrabold text-indigo-800 mb-1">Confirmation Receipt</h3>
                        <p class="text-xs text-indigo-700">
                            <strong>Task ID:</strong> <span id="receipt-task-id"></span><br>
                            <strong>Total Boxes:</strong> <span id="receipt-box-count"></span><br>
                            <strong>Time:</strong> <span id="receipt-time"></span>
                        </p>
                    </div>

                    <button class="mt-8 w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-xl transition duration-150 primary-btn" onclick="changeState('list')">
                        Continue to Next Task
                    </button>
                </div>
            </div>

        </main>

        <!-- Footer for Back Button on Annotate Screen (Mobile friendly placement) -->
        <footer id="footer-actions" class="p-4 bg-white border-t border-gray-200 hidden sticky bottom-0 z-10 shadow-t-lg">
             <button id="back-btn" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 rounded-xl transition duration-150 primary-btn" onclick="changeState('list')">
                <div class="flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    <span>Back to Task List</span>
                </div>
            </button>
        </footer>

    </div>

    <script>
        // JS strings and variables are intentionally left with Latin characters for code clarity,
        // but all user-facing text is translated in the HTML and JS function calls (like alert).

        const stateElements = {
            'list': document.getElementById('list-view'),
            'annotate': document.getElementById('annotate-view'),
            'submission': document.getElementById('submission-view')
        };
        const headerTitle = document.getElementById('header-title');
        const footerActions = document.getElementById('footer-actions');
        const imageElement = document.getElementById('current-image');
        const annotationArea = document.getElementById('annotation-area');
        const annotationsList = document.getElementById('annotations-list');
        const boxCountDisplay = document.getElementById('box-count');
        const submitCountDisplay = document.getElementById('submit-count');
        const noBoxesMessage = document.getElementById('no-boxes-message');
        
        let appState = 'list';
        let uniqueIdCounter = 0;

        let currentTask = {
            id: null,
            src: null,
            // Array to hold all final annotations (label + coords)
            annotations: [], 
            // Object to hold the bounding box currently being drawn
            tempBox: {
                id: null,
                x: 0, y: 0, w: 0, h: 0, 
                element: null, // DOM element for the box
                drawing: false
            } 
        };

        // --- State Management ---
        function changeState(newState) {
            appState = newState;
            
            // Hide all views and footer
            Object.values(stateElements).forEach(el => el.classList.add('hidden'));
            footerActions.classList.add('hidden');

            // Show current view
            if (newState === 'list') {
                stateElements.list.classList.remove('hidden');
                headerTitle.textContent = 'Task List';
            } else if (newState === 'annotate') {
                stateElements.annotate.classList.remove('hidden');
                footerActions.classList.remove('hidden'); // Show back button
                headerTitle.textContent = `Annotating ID: ${currentTask.id}`;
                updateAnnotationUI();
            } else if (newState === 'submitting' || newState === 'confirmed') {
                stateElements.submission.classList.remove('hidden');
                // Handle submission specific elements
                document.getElementById('loading-state').classList.toggle('hidden', newState === 'confirmed');
                document.getElementById('confirmation-state').classList.toggle('hidden', newState === 'submitting');
                headerTitle.textContent = newState === 'submitting' ? 'Processing Task...' : 'Task Completed';
            }
        }

        // --- Annotation Workflow ---
        function selectImage(cardElement) {
            currentTask.id = cardElement.getAttribute('data-id');
            currentTask.src = cardElement.getAttribute('data-src');
            currentTask.annotations = [];
            currentTask.tempBox = { id: null, x: 0, y: 0, w: 0, h: 0, element: null, drawing: false };
            
            // Clear previous boxes from the area
            annotationArea.querySelectorAll('.bounding-box').forEach(box => box.remove());

            imageElement.src = currentTask.src;
            document.getElementById('current-task-id-display').textContent = currentTask.id;
            
            changeState('annotate');
        }

        function updateAnnotationUI() {
            // 1. Update list of annotations
            annotationsList.innerHTML = '';
            
            const annotations = currentTask.annotations;
            
            noBoxesMessage.classList.toggle('hidden', annotations.length > 0);

            annotations.forEach(box => {
                const item = document.createElement('div');
                item.className = 'p-3 border border-indigo-200 bg-indigo-50 rounded-lg shadow-sm space-y-2';
                
                const coordsText = `(${Math.round(box.x)}, ${Math.round(box.y)}) W: ${Math.round(box.w)}, H: ${Math.round(box.h)}`;
                
                item.innerHTML = `
                    <div class="flex justify-between items-center">
                        <p class="font-bold text-sm text-indigo-800">Box #${box.id}</p>
                        <button onclick="removeAnnotation('${box.id}')" class="text-red-500 hover:text-red-700 text-xs font-semibold p-1 transition duration-150">
                            Remove
                        </button>
                    </div>
                    <p class="text-xs text-gray-700">${coordsText}</p>
                    <div class="flex space-x-2 items-center pt-2 border-t border-indigo-100">
                        <label for="label-${box.id}" class="text-sm font-medium text-gray-700">Label:</label>
                        <input type="text" id="label-${box.id}" value="${box.label}" placeholder="Enter label (e.g., 'Car')" 
                                oninput="updateAnnotationLabel('${box.id}', this.value)"
                                class="flex-grow rounded-lg border-gray-300 shadow-sm sm:text-sm p-2 border">
                    </div>
                `;
                annotationsList.appendChild(item);
                
                // Update the visual box label
                const boxElement = document.getElementById(`box-${box.id}`);
                if (boxElement) {
                    let labelTag = boxElement.querySelector('.box-label');
                    if (!labelTag) {
                        labelTag = document.createElement('div');
                        labelTag.className = 'box-label';
                        boxElement.appendChild(labelTag);
                    }
                    labelTag.textContent = box.label || `Box #${box.id}`;
                }
            });

            // 2. Update counters
            boxCountDisplay.textContent = annotations.length;
            submitCountDisplay.textContent = annotations.length;
        }

        function updateAnnotationLabel(id, label) {
            const index = currentTask.annotations.findIndex(ann => ann.id === id);
            if (index !== -1) {
                currentTask.annotations[index].label = label;
                
                // --- FIX: Update only the visual box label on the image, DO NOT re-render the entire list. ---
                const boxElement = document.getElementById(`box-${id}`);
                if (boxElement) {
                    let labelTag = boxElement.querySelector('.box-label');
                    if (labelTag) { 
                        // Update the text content of the existing label badge
                        labelTag.textContent = label || `Box #${id}`;
                    }
                }
                // Removed the call to updateAnnotationUI() which caused the input field to lose focus.
            }
        }

        function removeAnnotation(id) {
            // Remove from array
            currentTask.annotations = currentTask.annotations.filter(ann => ann.id !== id);
            
            // Remove from DOM
            const boxElement = document.getElementById(`box-${id}`);
            if (boxElement) {
                boxElement.remove();
            }
            
            updateAnnotationUI();
        }

        function clearAllAnnotations() {
            if (currentTask.annotations.length === 0) return;
            
            // Simple confirmation replacement (should be a modal in a real app)
            if (confirm("Are you sure you want to clear all " + currentTask.annotations.length + " annotations?")) {
                currentTask.annotations = [];
                // Remove all boxes from DOM
                annotationArea.querySelectorAll('.bounding-box').forEach(box => box.remove());
                updateAnnotationUI();
            }
        }
        
        // Custom confirm replacement function
        function confirm(message) {
            // NOTE: Using native confirm as an alert/confirm replacement for this demo, as per instructions.
            return window.confirm(message);
        }


        function submitAnnotation() {
            const finalAnnotations = currentTask.annotations.filter(ann => ann.label.trim() !== '');

            if (finalAnnotations.length === 0) {
                alert("Please draw and label at least one bounding box before submitting.");
                return;
            }

            // Set Task ID for loading screen
            document.getElementById('processing-id').textContent = currentTask.id;

            // Show loading state
            changeState('submitting');
            
            // Start loading animation and simulation
            const loadingBar = document.getElementById('loading-bar');
            loadingBar.style.width = '0%';
            
            // Simulate 2 second network delay + load bar animation
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                if (progress <= 100) {
                     loadingBar.style.width = `${progress}%`;
                } else {
                    clearInterval(interval);
                    
                    // Display confirmation state after loading is complete
                    showConfirmation(finalAnnotations.length);
                    // Clear the task's annotations to prepare for the next task
                    currentTask.annotations = []; 
                    annotationArea.querySelectorAll('.bounding-box').forEach(box => box.remove());
                }
            }, 100); 
        }

        function showConfirmation(totalBoxes) {
            
            // Update Receipt Data
            document.getElementById('confirmed-task-id').textContent = currentTask.id;
            document.getElementById('receipt-task-id').textContent = currentTask.id;
            document.getElementById('receipt-box-count').textContent = totalBoxes;
            document.getElementById('receipt-time').textContent = new Date().toLocaleTimeString('en-US');
            
            // Visually mark the task as done (for demonstration purposes)
            const card = document.querySelector(`.task-card[data-id="${currentTask.id}"]`);
            if (card) {
                // FIX: Use the class 'task-card-inner' which is consistently applied to the element we want to modify.
                const cardInner = card.querySelector('.task-card-inner'); 
                
                if (cardInner) {
                    // Remove interactivity and change style to completed
                    cardInner.classList.remove('cursor-pointer', 'bg-white', 'shadow-lg');
                    cardInner.classList.add('bg-gray-100', 'pointer-events-none', 'opacity-70');
                    
                    // Update badge
                    const badgeElement = cardInner.querySelector('.task-badge'); // Use the new task-badge class
                    if (badgeElement) {
                        badgeElement.classList.remove('bg-yellow-400', 'text-gray-800');
                        badgeElement.classList.add('bg-green-500', 'text-white');
                        badgeElement.textContent = 'COMPLETED';
                    }

                    // Add the processed visual effect (blur + overlay)
                    const imageContainer = cardInner.querySelector('.relative.w-full.h-32');
                    const img = imageContainer ? imageContainer.querySelector('img') : null;
                    if(img) img.classList.add('blur-sm');
                    
                    if (imageContainer && !imageContainer.querySelector('.absolute')) {
                         imageContainer.insertAdjacentHTML('beforeend', '<div class="absolute inset-0 flex items-center justify-center text-white font-extrabold text-xl bg-black bg-opacity-50">PROCESSED</div>');
                    }
                } else {
                    console.error("Error: Could not find .task-card-inner for task ID", currentTask.id);
                }
            }
            
            changeState('confirmed');
        }

        // --- Bounding Box Drawing Logic (Mouse & Touch) ---

        let isDrawing = false;
        let startX, startY;

        // Get coordinates relative to the annotation area
        function getRelativeCoords(event) {
            const rect = annotationArea.getBoundingClientRect();
            let clientX, clientY;

            // Handle touch events
            if (event.touches && event.touches.length > 0) {
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            } 
            // Handle mouse events
            else {
                clientX = event.clientX;
                clientY = event.clientY;
            }

            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function startDraw(event) {
            // Only allow drawing on the annotate screen
            if (appState !== 'annotate') return;

            // Prevent default touch actions like scrolling
            if (event.type === 'touchstart') {
                event.preventDefault(); 
            }
            
            isDrawing = true;
            const coords = getRelativeCoords(event);
            startX = coords.x;
            startY = coords.y;

            // 1. Create a NEW temporary box element
            uniqueIdCounter++;
            const boxId = `box-${uniqueIdCounter}`;
            
            const newBox = document.createElement('div');
            newBox.id = boxId;
            newBox.className = 'bounding-box temp-box';
            newBox.style.left = `${startX}px`;
            newBox.style.top = `${startY}px`;
            newBox.style.width = '0px';
            newBox.style.height = '0px';
            
            annotationArea.appendChild(newBox);
            
            // 2. Update temp state
            currentTask.tempBox = {
                id: uniqueIdCounter.toString(),
                x: startX, y: startY, w: 0, h: 0, 
                element: newBox,
                drawing: true
            };
        }

        function draw(event) {
            if (!isDrawing) return;
            
            // Prevent default touch actions like scrolling
            if (event.type === 'touchmove') {
                event.preventDefault(); 
            }

            const { element } = currentTask.tempBox;
            if (!element) return;

            const coords = getRelativeCoords(event);
            const currentX = coords.x;
            const currentY = coords.y;
            
            const x = Math.min(startX, currentX);
            const y = Math.min(startY, currentY);
            const w = Math.abs(startX - currentX);
            const h = Math.abs(startY - currentY);
            
            // Update the CSS for the bounding box
            Object.assign(element.style, {
                left: `${x}px`,
                top: `${y}px`,
                width: `${w}px`,
                height: `${h}px`
            });

            // Update the internal annotation data
            currentTask.tempBox.x = x;
            currentTask.tempBox.y = y;
            currentTask.tempBox.w = w;
            currentTask.tempBox.h = h;
        }

        function endDraw() {
            if (!isDrawing) return;
            isDrawing = false;
            
            const { id, x, y, w, h, element } = currentTask.tempBox;
            
            // 1. Check minimum size
            if (w < 10 || h < 10) {
                if (element) element.remove();
                currentTask.tempBox.drawing = false;
                alert("The box is too small. Please draw a larger area.");
                return;
            }

            // 2. Finalize the box visually and in data
            if (element) {
                element.classList.remove('temp-box');
                element.classList.add('final-box');
            }

            currentTask.annotations.push({
                id: id,
                x: x, y: y, 
                w: w, h: h, 
                label: '', // Label is empty initially
                elementId: element.id // Store reference to DOM ID
            });
            
            // 3. Reset tempBox and update UI
            currentTask.tempBox = { id: null, x: 0, y: 0, w: 0, h: 0, element: null, drawing: false };
            updateAnnotationUI();
        }

        // --- Event Listeners for Drawing (Mobile and Desktop) ---
        
        // Desktop (Mouse)
        annotationArea.addEventListener('mousedown', startDraw);
        annotationArea.addEventListener('mousemove', draw);
        window.addEventListener('mouseup', endDraw); // Listen on window for reliable end

        // Mobile (Touch)
        annotationArea.addEventListener('touchstart', startDraw);
        annotationArea.addEventListener('touchmove', draw);
        window.addEventListener('touchend', endDraw); // Listen on window for reliable end

        // Function to set the current date in the dashboard
        function setCurrentDate() {
            const dateElement = document.getElementById('current-date');
            if (dateElement) {
                const now = new Date();
                const options = { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' };
                dateElement.textContent = now.toLocaleDateString('en-US', options);
            }
        }

        // Initial state load
        window.onload = function() {
            setCurrentDate();
            changeState('list');
        }
        
        // Simple alert replacement for demonstration
        function alert(message) {
            console.warn("UI Message Box:", message);
            // Simulating a custom notification for better UX than native alert
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.className = 'fixed top-4 left-1/2 -translate-x-1/2 bg-red-600 text-white p-3 rounded-xl shadow-2xl z-50 transition duration-300 transform scale-100';
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.classList.remove('scale-100');
                notification.classList.add('opacity-0', 'scale-90');
                notification.addEventListener('transitionend', () => notification.remove());
            }, 3000);
        }

    </script>
</body>
</html>
